# An Jia You Xuan - Real Estate Website

[![Deploy to Vercel](https://github.com/Humpyt/An-Jia-website/actions/workflows/deploy-to-vercel.yml/badge.svg)](https://github.com/Humpyt/An-Jia-website/actions/workflows/deploy-to-vercel.yml)

A premium real estate website for showcasing properties in Kampala, Uganda.

## Current Application Architecture

### Overview
An Jia You Xuan is a modern real estate platform built with a headless CMS architecture:
- **Frontend**: Next.js 15 application with TypeScript and Tailwind CSS
- **Backend**: WordPress with custom post types and REST API
- **AI Integration**: DeepSeek AI for property description enhancement
- **Caching**: Multi-level caching system for optimized performance

### System Architecture Diagram
```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │      │                 │
│  Next.js 15     │◄────►│  WordPress API  │◄────►│  DeepSeek AI    │
│  Frontend       │      │  Backend        │      │  API            │
│                 │      │                 │      │                 │
└─────────────────┘      └─────────────────┘      └─────────────────┘
        ▲                        ▲
        │                        │
        ▼                        ▼
┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │
│  Client         │      │  Admin          │
│  Browser        │      │  Dashboard      │
│                 │      │                 │
└─────────────────┘      └─────────────────┘
```

## Features

### Property Management
- Featured Properties Section (Premium listings)
- Latest Properties Section with sorting by date
- Property categories: Apartments, Houses, Land, Hotels
- Detailed property information including:
  - Location and floor details
  - Bedrooms and bathrooms
  - Price and payment terms
  - Amenities (WiFi, Parking, Security, etc.)
  - Owner information
  - Property gallery
  - AI-enhanced property descriptions

### AI-Enhanced Content
- Professional property descriptions generated by DeepSeek AI
- Concise property summaries for better user experience
- Automatic enhancement of minimal property data
- Error handling and fallback mechanisms

### Caching System
- Multi-layered caching for improved performance:
  - API response caching (5 minutes)
  - Property listings cache (5 minutes)
  - Property details cache (10 minutes)
  - Description cache (1 hour)
- Cache control UI for manual refresh

### User Interface
- Streamlined navigation
- Responsive design for all devices
- Property listing form
- Advanced search and filtering
- Error boundaries for improved reliability
- Loading states and fallbacks

## Tech Stack

### Frontend
- **Framework**: Next.js 15 with App Router
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **UI Components**: Shadcn UI
- **State Management**: React Context API
- **Error Handling**: Custom Error Boundaries

### Backend
- **CMS**: WordPress with REST API
- **Custom Plugins**:
  - Custom Post Type UI
  - Advanced Custom Fields
  - ACF to REST API

### AI Integration
- **Provider**: DeepSeek AI
- **API Key**: Securely stored in environment variables
- **Features**:
  - Text enhancement
  - Content summarization
  - Timeout handling
  - Error recovery

## Development Environment

### Local Setup

1. **Frontend (Next.js)**:
   ```bash
   git clone https://github.com/Humpyt/An-Gia-Website.git
   cd An-Gia-Website
   npm install
   ```

2. **Environment Configuration**:
   ```bash
   # .env.local
   NEXT_PUBLIC_WORDPRESS_API_URL=http://anjia-wordpress.local/wp-json
   DEEPSEEK_API_KEY=sk-de1e05e92ed048d597ae24e64deb34c6
   ```

3. **Development Server**:
   ```bash
   npm run dev
   # Access at http://localhost:3000
   ```

### WordPress Backend

1. **Local WordPress Installation**:
   - Using Local by Flywheel with domain "anjia-wordpress.local"
   - PHP 8.1, MySQL 8.0
   - WordPress 6.4+

2. **Required Plugins**:
   - Custom Post Type UI (v1.13.5+)
   - Advanced Custom Fields PRO (v6.2.0+)
   - ACF to REST API (v3.3.3+)
   - WP REST API Cache (v1.3.0+)

3. **Custom Post Types**:
   - `property`: Real estate properties
   - `neighborhood`: Location information
   - `agent`: Real estate agents

4. **Custom Fields Structure**:
   ```
   property
   ├── basic_info
   │   ├── location (text)
   │   ├── property_type (select)
   │   ├── bedrooms (number)
   │   ├── bathrooms (number)
   │   └── square_meters (number)
   ├── pricing
   │   ├── price (number)
   │   ├── currency (select)
   │   └── payment_terms (select)
   ├── features
   │   ├── amenities (checkbox)
   │   ├── floor (number)
   │   └── units (number)
   └── media
       ├── gallery_images (gallery)
       └── google_pin (text)
   ```

## API Integration

### WordPress REST API

- **Base URL**: `http://anjia-wordpress.local/wp-json/`
- **Endpoints**:
  - Properties List: `GET /wp/v2/property?per_page=12&offset=0`
  - Property Detail: `GET /wp/v2/property/{id}`
  - Property Search: `GET /wp/v2/property?search={term}`
  - Property Filter: `GET /wp/v2/property?meta_key=bedrooms&meta_value=3`
  - Cache Control: `POST /api/cache` (custom endpoint)

### DeepSeek AI Integration

- **API Endpoint**: `https://api.deepseek.com/v1/chat/completions`
- **Model**: `deepseek-chat`
- **Implementation**:
  ```typescript
  // Sample implementation
  const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${process.env.DEEPSEEK_API_KEY}`
    },
    body: JSON.stringify({
      model: "deepseek-chat",
      messages: [
        {
          role: "system",
          content: "You are a professional real estate copywriter."
        },
        {
          role: "user",
          content: `Enhance this property description: ${description}`
        }
      ],
      max_tokens: 500
    })
  });
  ```

## Caching Architecture

### Multi-Level Caching System

1. **API Cache** (5 minutes):
   - Caches raw WordPress API responses
   - Implemented in `lib/wordpress.js`
   - Size: `API_CACHE.size`

2. **Property Listings Cache** (5 minutes):
   - Caches transformed property listings
   - Implemented in `lib/wordpress.js`
   - Size: `PROPERTY_LISTINGS_CACHE.size`

3. **Property Details Cache** (10 minutes):
   - Caches individual property details
   - Implemented in `lib/wordpress.js`
   - Size: `PROPERTY_DETAILS_CACHE.size`

4. **Description Cache** (1 hour):
   - Caches AI-enhanced descriptions
   - Implemented in `lib/wordpress.js`
   - Size: `DESCRIPTION_CACHE.size`

5. **Next.js Cache** (60 seconds):
   - Built-in Next.js data cache
   - Configured with `next: { revalidate: 60 }`

### Cache Control

- **Manual Cache Clearing**:
  - UI button in property detail page
  - API endpoint: `POST /api/cache`
  - Parameters: `{ cacheType: 'all' | 'api' | 'properties' | 'descriptions' }`

## Error Handling

### Client-Side Error Boundaries

- **Implementation**: React Error Boundary component
- **Location**: `components/error-boundary.tsx`
- **Features**:
  - Graceful error recovery
  - User-friendly error messages
  - Refresh and navigation options

### API Error Handling

- **Timeout Handling**: 10-second timeout for external API calls
- **Fallback Mechanisms**: Default descriptions when AI fails
- **Retry Logic**: Automatic retry for transient errors

## Performance Optimizations

1. **Image Optimization**:
   - Next.js Image component with automatic optimization
   - Responsive image sizes
   - Lazy loading

2. **Code Splitting**:
   - Automatic code splitting with Next.js
   - Dynamic imports for large components

3. **Server-Side Rendering**:
   - Critical paths rendered on server
   - Client-side hydration for interactivity

4. **Data Prefetching**:
   - Prefetch data for common navigation paths
   - Cache results for improved performance

## Deployment

### Vercel Deployment

The An Jia website is configured for deployment on Vercel. Follow these steps to deploy:

1. **Prepare for Deployment**:
   ```bash
   # Update environment variables for production
   # Edit .env.local with production WordPress API URL
   ```

2. **Deploy to Vercel**:
   ```bash
   # Using the provided deployment script
   npm run vercel:deploy

   # Or manually via Vercel CLI
   vercel --prod
   ```

3. **Environment Variables**:
   - Set the following environment variables in Vercel:
     - `NEXT_PUBLIC_WORDPRESS_API_URL`: Your production WordPress API URL
     - `WORDPRESS_API_URL`: Same as above
     - `WORDPRESS_FALLBACK_API_URL`: Same as above
     - `DEEPSEEK_API_KEY`: Your DeepSeek API key

### Namecheap Domain Setup

To connect a Namecheap domain to your Vercel deployment:

1. Purchase a domain on Namecheap
2. Configure DNS settings to point to Vercel
3. Add the domain in your Vercel project settings
4. Verify domain ownership
5. Set up SSL certificate

For detailed instructions, see the [Namecheap and Vercel Deployment Guide](NAMECHEAP-VERCEL-GUIDE.md).

### WordPress Production Setup

For setting up a production WordPress instance to serve as the API backend:

1. Set up WordPress on a hosting provider
2. Install and configure required plugins
3. Set up custom post types and fields
4. Configure security settings
5. Connect your Next.js frontend to the WordPress API

For detailed instructions, see the [WordPress Production Setup Guide](WORDPRESS-PRODUCTION-SETUP.md).

## License

[MIT](LICENSE)
